<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Elon Musk Tweet Activity Heatmap</title>

    <!-- Resource hints for better performance -->
    <link rel="dns-prefetch" href="//corsproxy.io">
    <link rel="dns-prefetch" href="//www.xtracker.io">
    <link rel="preconnect" href="https://corsproxy.io" crossorigin>
    <link rel="preconnect" href="https://www.xtracker.io" crossorigin>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <style>
      /* Smooth transitions for data updates */
      .fade-enter {
        opacity: 0;
        transform: translateY(10px);
      }
      .fade-enter-active {
        opacity: 1;
        transform: translateY(0);
        transition: opacity 0.3s ease, transform 0.3s ease;
      }
      .fade-exit {
        opacity: 1;
      }
      .fade-exit-active {
        opacity: 0;
        transition: opacity 0.2s ease;
      }

      /* Cell animation */
      .cell-update {
        animation: cellPulse 0.5s ease;
      }

      @keyframes cellPulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); opacity: 0.8; }
        100% { transform: scale(1); opacity: 1; }
      }

      /* Smooth color transitions */
      .heatmap-cell {
        transition: background-color 0.3s ease, border-color 0.3s ease;
      }

      /* Loading animation */
      @keyframes shimmer {
        0% { background-position: -468px 0; }
        100% { background-position: 468px 0; }
      }

      .shimmer {
        animation: shimmer 2s ease-in-out infinite;
        background: linear-gradient(to right, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%);
        background-size: 1000px 100%;
      }

      /* High value glow effect */
      @keyframes glow {
        0%, 100% { box-shadow: 0 0 5px rgba(34, 197, 94, 0.5); }
        50% { box-shadow: 0 0 20px rgba(34, 197, 94, 0.8); }
      }

      .high-value-glow {
        animation: glow 2s ease-in-out infinite;
      }

      /* Horizontal scroll indicators */
      .scroll-indicator {
        position: relative;
      }

      .scroll-indicator::before,
      .scroll-indicator::after {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        width: 30px;
        pointer-events: none;
        z-index: 10;
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .scroll-indicator::before {
        left: 0;
        background: linear-gradient(to right, rgba(107, 114, 128, 0.2), transparent);
      }

      .scroll-indicator::after {
        right: 0;
        background: linear-gradient(to left, rgba(107, 114, 128, 0.2), transparent);
      }

      .scroll-indicator.can-scroll-left::before,
      .scroll-indicator.can-scroll-right::after {
        opacity: 1;
      }

      @media (max-width: 768px) {
        .scroll-indicator::before,
        .scroll-indicator::after {
          width: 20px;
        }
      }

      /* Mobile - show full heatmap without scroll */
      @media (max-width: 768px) {
        /* Make table fit in container */
        #heatmapContainer table,
        #averageHeatmapContainer table {
          table-layout: fixed;
          width: 100%;
        }
      }

      /* Info badge wrapper for relative positioning */
      .info-badge-wrapper {
        position: relative;
        display: inline-block;
      }

    </style>
  </head>
  <body
    class="bg-gray-50 dark:bg-gray-900 p-3 sm:p-4 lg:p-5 transition-colors duration-300 font-sans"
  >
    <div
      class="max-w-7xl mx-auto bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 sm:p-5 lg:p-6 transition-colors duration-300"
    >
      <!-- Title Section - Independent on Desktop -->
      <h1 class="text-xl sm:text-2xl md:text-2xl font-bold text-gray-900 dark:text-gray-100 text-center mb-4 pb-3 sm:pb-4 border-b border-gray-200 dark:border-gray-700">
        <span class="hidden sm:inline">ğŸ¦</span> Elon Musk Tweet Activity
      </h1>

      <!-- Controls Section - Mobile/Tablet: Stacked, Desktop: Single Row -->
      <div class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 mb-4">
        <div class="flex flex-col lg:grid lg:grid-cols-2 lg:gap-4">
          <!-- Date Range - 50% -->
          <div class="mb-3 lg:mb-0">
            <select
              id="weekRange"
              class="w-full px-3 py-2.5 text-xs sm:text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 font-bold min-h-[44px]"
              onchange="updateDateRange()"
            >
              <option value="">Select a week range...</option>
            </select>
          </div>

          <!-- Button Controls - 50% -->
          <div class="grid grid-cols-2 lg:flex lg:justify-between gap-2">
          <button
            id="updateBtn"
            onclick="handleButtonClick(event, () => loadData(true))"
            class="px-3 py-2.5 lg:flex-1 text-xs sm:text-sm bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white rounded-md font-bold transition-all duration-200 transform active:scale-95 min-h-[44px] whitespace-nowrap"
          >
            <span class="lg:hidden">ğŸ”„ Update</span>
            <span class="hidden lg:inline">ğŸ”„ Update</span>
          </button>
          <button
            onclick="handleButtonClick(event, toggleAutoRefresh)"
            id="autoRefreshBtn"
            class="px-3 py-2.5 lg:flex-1 text-xs sm:text-sm bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 text-white rounded-md font-bold transition-all duration-200 transform active:scale-95 min-h-[44px] whitespace-nowrap"
          >
            <span class="lg:hidden">â° Auto</span>
            <span class="hidden lg:inline">â° Auto Refresh</span>
          </button>
          <button
            onclick="handleButtonClick(event, downloadCSV)"
            class="px-3 py-2.5 lg:flex-1 text-xs sm:text-sm bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md font-bold transition-all duration-200 transform active:scale-95 min-h-[44px] whitespace-nowrap"
          >
            <span class="lg:hidden">ğŸ“¥ CSV</span>
            <span class="hidden lg:inline">ğŸ“¥ Download</span>
          </button>
          <button
            onclick="handleButtonClick(event, toggleDarkMode)"
            class="px-3 py-2.5 lg:w-12 lg:px-0 text-xs sm:text-sm bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-gray-200 rounded-md font-bold transition-all duration-200 transform active:scale-95 min-h-[44px] flex items-center justify-center"
          >
            <span id="darkModeIcon" class="text-base">ğŸŒ™</span>
          </button>
        </div>
      </div>
      </div>

      <!-- Statistics Section -->
      <div class="bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-3 mb-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-2 sm:gap-3">
        <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
          <div class="text-gray-500 dark:text-gray-300 text-xs sm:text-sm font-semibold mb-1">
            Current Week
          </div>
          <div
            id="currentValue"
            class="text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100"
          >
            -
          </div>
        </div>
        <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
          <div class="text-gray-500 dark:text-gray-300 text-xs sm:text-sm font-semibold mb-1">
            4-Week Avg
          </div>
          <div
            id="avgValue"
            class="text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100"
          >
            -
          </div>
        </div>
        <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
          <div class="text-gray-500 dark:text-gray-300 text-xs sm:text-sm font-semibold mb-1">
            Last Tweet
          </div>
          <div
            id="lastTweetTime"
            class="text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100"
          >
            -
          </div>
        </div>
        <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
          <div class="text-gray-500 dark:text-gray-300 text-xs sm:text-sm font-semibold mb-1">
            Last Updated
          </div>
          <div
            id="lastUpdated"
            class="text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100"
          >
            -
          </div>
        </div>
      </div>
      </div>

      <!-- Predictions Section -->
      <div
        class="bg-blue-50 dark:bg-blue-900/20 border border-blue-300 dark:border-blue-700 rounded-lg p-3 mb-4"
      >
        <div class="grid grid-cols-3 lg:grid-cols-5 gap-2 sm:gap-3">
          <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
            <div
              class="flex items-center text-gray-500 dark:text-gray-300 text-xs sm:text-sm font-semibold mb-1"
            >
              <span class="mr-1 text-xs sm:text-sm">â±ï¸</span> Current Pace
              <div class="info-badge-wrapper">
                <span class="inline-flex items-center justify-center w-4 h-4 ml-1 text-[11px] font-bold rounded-full border border-blue-500 dark:border-blue-400 text-blue-600 dark:text-blue-400 hover:bg-blue-500 hover:border-blue-500 hover:text-white dark:hover:bg-blue-500 dark:hover:border-blue-500 cursor-help transition-all duration-200">i</span>
                <div class="hidden absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-56 p-3 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 text-xs rounded-lg shadow-xl z-50 tooltip-content">
                  <div class="font-semibold mb-1">í˜„ì¬ í˜ì´ìŠ¤ ìœ ì§€ ì‹œ ê¸°ê°„ ì¢…ë£Œê¹Œì§€ ì˜ˆìƒ ì´ íŠ¸ìœ— ìˆ˜</div>
                  <div class="text-gray-300 dark:text-gray-600 text-[11px]">(í˜„ì¬ íŠ¸ìœ—ìˆ˜ Ã· ê²½ê³¼ì‹œê°„) Ã— ì „ì²´ ê¸°ê°„</div>
                  <div class="absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900 dark:border-t-gray-100"></div>
                </div>
              </div>
            </div>
            <div
              id="currentPace"
              class="text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100"
            >
              -
            </div>
          </div>
          <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
            <div
              class="flex items-center text-gray-500 dark:text-gray-300 text-xs sm:text-sm font-semibold mb-1"
            >
              <span class="mr-1 text-xs sm:text-sm">ğŸ”®</span> Next 24h
              <div class="info-badge-wrapper">
                <span class="inline-flex items-center justify-center w-4 h-4 ml-1 text-[11px] font-bold rounded-full border border-blue-500 dark:border-blue-400 text-blue-600 dark:text-blue-400 hover:bg-blue-500 hover:border-blue-500 hover:text-white dark:hover:bg-blue-500 dark:hover:border-blue-500 cursor-help transition-all duration-200">i</span>
                <div class="hidden absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-56 p-3 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 text-xs rounded-lg shadow-xl z-50 tooltip-content">
                  <div class="font-semibold mb-1">í–¥í›„ 24ì‹œê°„ ì˜ˆìƒ íŠ¸ìœ— ìˆ˜ (90% ì‹ ë¢°êµ¬ê°„)</div>
                  <div class="text-gray-300 dark:text-gray-600 text-[11px]">ì‹œê°„ëŒ€ë³„ 4ì£¼ í‰ê·  íŒ¨í„´ Ã— (íŠ¸ë Œë“œ 70% + ëª¨ë©˜í…€ 30%)</div>
                  <div class="absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900 dark:border-t-gray-100"></div>
                </div>
              </div>
            </div>
            <div
              id="next24hPrediction"
              class="text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100"
            >
              -
            </div>
          </div>
          <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
            <div
              class="flex items-center text-gray-500 dark:text-gray-300 text-xs sm:text-sm font-semibold mb-1"
            >
              <span class="mr-1 text-xs sm:text-sm">ğŸ¯</span> End of Range
              <div class="info-badge-wrapper">
                <span class="inline-flex items-center justify-center w-4 h-4 ml-1 text-[11px] font-bold rounded-full border border-blue-500 dark:border-blue-400 text-blue-600 dark:text-blue-400 hover:bg-blue-500 hover:border-blue-500 hover:text-white dark:hover:bg-blue-500 dark:hover:border-blue-500 cursor-help transition-all duration-200">i</span>
                <div class="hidden absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-56 p-3 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 text-xs rounded-lg shadow-xl z-50 tooltip-content">
                  <div class="font-semibold mb-1">ê¸°ê°„ ì¢…ë£Œ ì‹œ ì˜ˆìƒ ì´ íŠ¸ìœ— ìˆ˜ (90% ì‹ ë¢°êµ¬ê°„)</div>
                  <div class="text-gray-300 dark:text-gray-600 text-[11px]">í˜„ì¬ íŠ¸ìœ—ìˆ˜ + (ë‚¨ì€ ì‹œê°„ë³„ 4ì£¼ í‰ê·  Ã— (íŠ¸ë Œë“œ 70% + ëª¨ë©˜í…€ 30%))</div>
                  <div class="absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900 dark:border-t-gray-100"></div>
                </div>
              </div>
            </div>
            <div
              id="weekEndPrediction"
              class="text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100"
            >
              -
            </div>
          </div>
          <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
            <div
              class="flex items-center text-gray-500 dark:text-gray-300 text-xs sm:text-sm font-semibold mb-1"
            >
              <span class="mr-1 text-xs sm:text-sm">ğŸ“Š</span> Trend
              <div class="info-badge-wrapper">
                <span class="inline-flex items-center justify-center w-4 h-4 ml-1 text-[11px] font-bold rounded-full border border-blue-500 dark:border-blue-400 text-blue-600 dark:text-blue-400 hover:bg-blue-500 hover:border-blue-500 hover:text-white dark:hover:bg-blue-500 dark:hover:border-blue-500 cursor-help transition-all duration-200">i</span>
                <div class="hidden absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-56 p-3 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 text-xs rounded-lg shadow-xl z-50 tooltip-content">
                  <div class="font-semibold mb-1">ì „ì²´ í™œë™ ì¶”ì„¸ (4ì£¼ í‰ê·  ëŒ€ë¹„)</div>
                  <div class="text-gray-300 dark:text-gray-600 text-[11px]">í˜„ì¬ ì´ íŠ¸ìœ— Ã· ë™ì¼ ê²½ê³¼ì‹œê°„ 4ì£¼ í‰ê· </div>
                  <div class="absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900 dark:border-t-gray-100"></div>
                </div>
              </div>
            </div>
            <div
              id="trendIndicator"
              class="text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100"
            >
              -
            </div>
          </div>
          <div class="bg-gray-100 dark:bg-gray-700 p-3 rounded-lg">
            <div
              class="flex items-center text-gray-500 dark:text-gray-300 text-xs sm:text-sm font-semibold mb-1"
            >
              <span class="mr-1 text-xs sm:text-sm">âš¡</span> Momentum
              <div class="info-badge-wrapper">
                <span class="inline-flex items-center justify-center w-4 h-4 ml-1 text-[11px] font-bold rounded-full border border-blue-500 dark:border-blue-400 text-blue-600 dark:text-blue-400 hover:bg-blue-500 hover:border-blue-500 hover:text-white dark:hover:bg-blue-500 dark:hover:border-blue-500 cursor-help transition-all duration-200">i</span>
                <div class="hidden absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-56 p-3 bg-gray-900 dark:bg-gray-100 text-white dark:text-gray-900 text-xs rounded-lg shadow-xl z-50 tooltip-content">
                  <div class="font-semibold mb-1">ìµœê·¼ 6ì‹œê°„ ê°€ì†ë„ (4ì£¼ í‰ê·  ëŒ€ë¹„)</div>
                  <div class="text-gray-300 dark:text-gray-600 text-[11px]">ìµœê·¼ 6ì‹œê°„ ì‹¤ì œ Ã· ìµœê·¼ 6ì‹œê°„ 4ì£¼ í‰ê· </div>
                  <div class="absolute top-full left-1/2 -translate-x-1/2 -mt-1 border-4 border-transparent border-t-gray-900 dark:border-t-gray-100"></div>
                </div>
              </div>
            </div>
            <div
              id="momentumIndicator"
              class="text-base sm:text-lg font-bold text-gray-900 dark:text-gray-100"
            >
              -
            </div>
          </div>
        </div>
      </div>

      <div class="grid lg:grid-cols-2 gap-4 sm:gap-5 lg:gap-6 mt-4 sm:mt-5 lg:mt-6">
        <div
          class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-3 sm:p-4 flex flex-col"
        >
          <h3
            class="text-base sm:text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3 sm:mb-4"
          >
            Current Week
          </h3>
          <div id="heatmapContainer" class="md:overflow-x-auto md:scroll-indicator flex-1">
            <!-- Skeleton loader will be inserted here -->
          </div>
        </div>
        <div
          class="bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-3 sm:p-4 flex flex-col"
        >
          <h3
            class="text-base sm:text-lg font-semibold text-gray-900 dark:text-gray-100 mb-3 sm:mb-4"
          >
            4-Week Average
          </h3>
          <div id="averageHeatmapContainer" class="md:overflow-x-auto md:scroll-indicator flex-1">
            <!-- Skeleton loader will be inserted here -->
          </div>
        </div>
      </div>

      <div
        class="flex items-center justify-center gap-2 mt-4 sm:mt-5 lg:mt-6 p-3 sm:p-4 bg-gray-50 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg"
      >
        <span class="text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400"
          >Less</span
        >
        <div class="flex gap-1">
          <div
            class="w-6 h-6 rounded bg-green-50 dark:bg-gray-900 border border-gray-300 dark:border-gray-600"
          ></div>
          <div
            class="w-6 h-6 rounded bg-green-200 dark:bg-green-950 border border-gray-300 dark:border-gray-600"
          ></div>
          <div
            class="w-6 h-6 rounded bg-green-300 dark:bg-green-900 border border-gray-300 dark:border-gray-600"
          ></div>
          <div
            class="w-6 h-6 rounded bg-green-500 dark:bg-green-700 border border-gray-300 dark:border-gray-600"
          ></div>
          <div
            class="w-6 h-6 rounded bg-green-700 dark:bg-green-500 border border-gray-300 dark:border-gray-600"
          ></div>
        </div>
        <span class="text-xs sm:text-sm font-medium text-gray-600 dark:text-gray-400"
          >More</span
        >
      </div>
    </div>

    <script type="module">
      // Import main application module
      console.log('Starting module import...');

      import { init } from './src/main/app.js';

      console.log('Module imported successfully, calling init()...');

      // Initialize app when DOM is ready
      init();

      console.log('init() called');

      // Handle tooltip toggle
      document.addEventListener('DOMContentLoaded', () => {
        const wrappers = document.querySelectorAll('.info-badge-wrapper');

        wrappers.forEach(wrapper => {
          const badge = wrapper.querySelector('span');
          const tooltip = wrapper.querySelector('.tooltip-content');

          if (!badge || !tooltip) return;

          // Desktop: hover
          if (window.matchMedia('(hover: hover)').matches) {
            badge.addEventListener('mouseenter', () => {
              tooltip.classList.remove('hidden');
            });

            badge.addEventListener('mouseleave', () => {
              tooltip.classList.add('hidden');
            });
          }

          // Mobile: click
          badge.addEventListener('click', (e) => {
            e.stopPropagation();

            // Close other tooltips
            wrappers.forEach(otherWrapper => {
              if (otherWrapper !== wrapper) {
                const otherTooltip = otherWrapper.querySelector('.tooltip-content');
                if (otherTooltip) {
                  otherTooltip.classList.add('hidden');
                }
              }
            });

            // Toggle current tooltip
            tooltip.classList.toggle('hidden');
          });
        });

        // Close tooltips when clicking outside
        document.addEventListener('click', () => {
          wrappers.forEach(wrapper => {
            const tooltip = wrapper.querySelector('.tooltip-content');
            if (tooltip) {
              tooltip.classList.add('hidden');
            }
          });
        });
      });
    </script>
  </body>
</html>
